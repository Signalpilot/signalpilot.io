<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Trading Tools | Position Size, Risk & Kelly Calculator</title>
  <meta name="description" content="14 free trading calculators: position sizing, risk/reward, drawdown recovery, Kelly criterion, and more. No signup required.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://signalpilot.io/tools/">

  <!-- Open Graph -->
  <meta property="og:title" content="Free Trading Tools | 14 Essential Calculators">
  <meta property="og:description" content="Position size, risk/reward, drawdown recovery, Kelly criterion & more. Free, no signup.">
  <meta property="og:url" content="https://signalpilot.io/tools/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://signalpilot.io/assets/og-tools.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Free Trading Tools | 14 Essential Calculators">
  <meta name="twitter:description" content="Position size, risk/reward, drawdown recovery, Kelly criterion & more. Free, no signup.">
  <meta name="twitter:image" content="https://signalpilot.io/assets/og-tools.png">

  <link rel="icon" href="/favicon.ico">

  <!-- Space Grotesk Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #05070d;
      --bg-soft: #0c111c;
      --bg-elev: #101626;
      --text: #ecf1ff;
      --muted: #b7c2d9;
      --muted-2: #8ea0bf;
      --brand: #5b8aff;
      --brand-2: #7b9bff;
      --accent: #76ddff;
      --good: #3ed598;
      --warn: #f9a23c;
      --bad: #ff6b6b;
      --border: rgba(255,255,255,.12);
      --radius: 16px;
      --shadow: 0 18px 60px rgba(12,16,27,.35);
      --grad: linear-gradient(90deg,#9cc0ff 0%,#86a8ff 35%,#7ccaff 60%,#8ca5ff 85%,#b9d4ff 100%);
    }

    [data-theme="light"] {
      --bg: #f0f4f8;
      --bg-soft: #ffffff;
      --bg-elev: #ffffff;
      --text: #0c111c;
      --muted: #4a5568;
      --muted-2: #718096;
      --border: rgba(0,0,0,.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Space Grotesk", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 3rem;
      padding-top: 1rem;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s;
    }

    .back-link:hover {
      color: var(--brand);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      font-size: 0.85rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      border-color: var(--brand);
      color: var(--text);
    }

    .header h1 {
      font-size: 2.75rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      color: var(--muted);
      font-size: 1.15rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Share Bar */
    .share-bar {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .share-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1rem;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      font-size: 0.85rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .share-btn:hover {
      border-color: var(--brand);
      color: var(--text);
      box-shadow: 0 0 20px rgba(91,138,255,.15);
    }

    .share-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Section Headers */
    .section-header {
      margin: 3rem 0 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .section-header h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .section-header span {
      color: var(--muted-2);
      font-weight: 400;
      font-size: 0.9rem;
      margin-left: 0.5rem;
    }

    /* Tools Grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
      gap: 1.25rem;
    }

    /* Tool Card */
    .tool-card {
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      transition: all 0.2s;
    }

    .tool-card:hover {
      border-color: var(--brand);
      box-shadow: 0 0 30px rgba(91,138,255,.1);
    }

    .tool-card h3 {
      font-size: 1.15rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tool-card .description {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1.25rem;
      line-height: 1.5;
    }

    .tool-card .form-area {
      flex: 1;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.7rem 0.85rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.95rem;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(91,138,255,.15);
    }

    .form-group input::placeholder {
      color: var(--muted-2);
      opacity: 0.6;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--muted-2);
      margin-top: 0.3rem;
    }

    /* Calculate Button */
    .calc-btn {
      width: 100%;
      padding: 0.85rem 1.25rem;
      background: var(--brand);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: auto;
    }

    .calc-btn:hover {
      background: var(--brand-2);
      box-shadow: 0 4px 20px rgba(91,138,255,.3);
    }

    /* Results */
    .results {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--border);
      display: none;
    }

    .results.show {
      display: block;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
    }

    .result-row:not(:last-child) {
      border-bottom: 1px solid var(--border);
    }

    .result-label {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .result-value {
      font-weight: 600;
      font-size: 1rem;
    }

    .result-value.highlight {
      color: var(--brand);
      font-size: 1.2rem;
    }

    .result-value.good { color: var(--good); }
    .result-value.warn { color: var(--warn); }
    .result-value.bad { color: var(--bad); }

    /* Insight Box */
    .insight {
      margin-top: 1rem;
      padding: 0.85rem 1rem;
      background: rgba(91,138,255,0.08);
      border-left: 3px solid var(--brand);
      border-radius: 0 8px 8px 0;
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .insight strong {
      color: var(--text);
    }

    /* Verdict Badge */
    .verdict {
      display: inline-block;
      padding: 0.3rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .verdict.good {
      background: rgba(62,213,152,0.15);
      color: var(--good);
      border: 1px solid var(--good);
    }

    .verdict.warn {
      background: rgba(249,162,60,0.15);
      color: var(--warn);
      border: 1px solid var(--warn);
    }

    .verdict.bad {
      background: rgba(255,107,107,0.15);
      color: var(--bad);
      border: 1px solid var(--bad);
    }

    /* Share Result Button */
    .share-result {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      margin-top: 1rem;
      padding: 0.5rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--muted);
      font-size: 0.8rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .share-result.show {
      display: flex;
    }

    .share-result:hover {
      border-color: var(--brand);
      color: var(--text);
    }

    /* Learn Link */
    .learn-link {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      margin-top: 0.75rem;
      padding: 0.4rem 0;
      color: var(--accent);
      font-size: 0.8rem;
      text-decoration: none;
      transition: all 0.2s;
    }

    .learn-link:hover {
      color: var(--brand);
      gap: 0.5rem;
    }

    /* Blog Section */
    .blog-section {
      margin-top: 3rem;
      padding: 2rem;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }

    .blog-section h2 {
      font-size: 1.25rem;
      margin-bottom: 1.25rem;
      color: var(--text);
    }

    .blog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }

    .blog-card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.2s;
    }

    .blog-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .blog-icon {
      font-size: 1.5rem;
      min-width: 40px;
      text-align: center;
    }

    .blog-card h3 {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 0.2rem;
    }

    .blog-card p {
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* Embed Modal */
    .embed-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      text-align: center;
    }

    .embed-section h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .embed-section p {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .embed-code {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.75rem;
      color: var(--accent);
      word-break: break-all;
      text-align: left;
      margin-bottom: 1rem;
    }

    .embed-btn {
      padding: 0.6rem 1.25rem;
      background: transparent;
      border: 1px solid var(--brand);
      border-radius: 8px;
      color: var(--brand);
      font-size: 0.9rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .embed-btn:hover {
      background: var(--brand);
      color: white;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 3rem 0 2rem;
      margin-top: 2rem;
      border-top: 1px solid var(--border);
    }

    .footer .see-all {
      display: inline-block;
      color: var(--brand);
      text-decoration: none;
      font-weight: 500;
      margin-bottom: 1rem;
      transition: color 0.2s;
    }

    .footer .see-all:hover {
      color: var(--accent);
    }

    .footer p {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .footer a {
      color: var(--text);
      text-decoration: none;
    }

    .footer a:hover {
      color: var(--brand);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-soft);
      border: 1px solid var(--brand);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Modal Overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: var(--bg-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem;
      max-width: 450px;
      width: 100%;
    }

    .modal h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }

    .modal p {
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
    }

    .modal input[type="email"] {
      width: 100%;
      padding: 0.85rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 1rem;
      font-family: inherit;
      margin-bottom: 1rem;
    }

    .modal input[type="email"]:focus {
      outline: none;
      border-color: var(--brand);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.25rem;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .checkbox-row input {
      width: auto;
      margin: 0;
    }

    .modal-actions {
      display: flex;
      gap: 0.75rem;
    }

    .modal-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.cancel {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .modal-btn.cancel:hover {
      border-color: var(--brand);
      color: var(--text);
    }

    .modal-btn.submit {
      background: var(--brand);
      border: none;
      color: white;
    }

    .modal-btn.submit:hover {
      background: var(--brand-2);
    }

    /* Share Card Modal */
    .share-card-preview {
      background: linear-gradient(135deg, #0c111c 0%, #05070d 100%);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .share-card-preview .card-result {
      font-size: 2rem;
      font-weight: 700;
      background: var(--grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.25rem;
    }

    .share-card-preview .card-label {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .share-card-preview .card-verdict {
      display: inline-block;
      padding: 0.3rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .share-card-preview .card-verdict.good {
      background: rgba(62,213,152,0.15);
      color: var(--good);
    }

    .share-card-preview .card-verdict.warn {
      background: rgba(249,162,60,0.15);
      color: var(--warn);
    }

    .share-card-preview .card-verdict.bad {
      background: rgba(255,107,107,0.15);
      color: var(--bad);
    }

    .share-card-preview .card-brand {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--muted-2);
    }

    .share-buttons-row {
      display: flex;
      gap: 0.5rem;
    }

    .share-buttons-row button {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .share-buttons-row button:hover {
      border-color: var(--brand);
    }

    .share-buttons-row button svg {
      width: 18px;
      height: 18px;
    }

    /* Quiz Promo */
    .quiz-promo {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(91,138,255,0.1) 0%, rgba(118,221,255,0.1) 100%);
      border: 1px solid var(--brand);
      border-radius: var(--radius);
      text-align: center;
    }

    .quiz-promo h3 {
      font-size: 1.15rem;
      margin-bottom: 0.5rem;
    }

    .quiz-promo p {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .quiz-promo a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--brand);
      border-radius: 8px;
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s;
    }

    .quiz-promo a:hover {
      background: var(--brand-2);
      box-shadow: 0 4px 20px rgba(91,138,255,.3);
    }

    /* Mobile */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }

      .tools-grid {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .header-top {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-top">
        <a href="/" class="back-link">‚Üê Back to Signal Pilot</a>
        <button class="theme-toggle" onclick="toggleTheme()">
          <span id="theme-icon">üåô</span>
          <span id="theme-text">Dark</span>
        </button>
      </div>

      <h1>Free Trading Tools</h1>
      <p>Professional calculators for position sizing, risk management, and performance analysis</p>

      <div class="share-bar">
        <a href="https://twitter.com/intent/tweet?text=Free%20trading%20calculators%20for%20position%20sizing%2C%20risk%20management%20%26%20Kelly%20criterion&url=https://signalpilot.io/tools/" target="_blank" rel="noopener" class="share-btn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          Share
        </a>
        <a href="https://reddit.com/submit?url=https://signalpilot.io/tools/&title=Free%20Trading%20Tools%20-%20Position%20Size%20%26%20Risk%20Calculators" target="_blank" rel="noopener" class="share-btn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
          Reddit
        </a>
        <button class="share-btn" onclick="copyLink()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
          Copy Link
        </button>
        <button class="share-btn" onclick="showEmailModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          Get Tips
        </button>
      </div>
    </header>

    <!-- ESSENTIAL TOOLS -->
    <div class="section-header">
      <h2>Essential <span>‚Äî Start here</span></h2>
    </div>

    <div class="tools-grid">
      <!-- Position Size Calculator -->
      <div class="tool-card">
        <h3>üìê Position Size Calculator</h3>
        <p class="description">Calculate exactly how many shares to buy based on your account size and risk tolerance.</p>
        <div class="form-area">
          <div class="form-group">
            <label>Account Balance ($)</label>
            <input type="number" id="ps-balance" placeholder="10000">
          </div>
          <div class="form-group">
            <label>Risk Per Trade (%)</label>
            <input type="number" id="ps-risk" placeholder="1">
            <p class="hint">Professional traders risk 0.5% - 2% per trade</p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Entry Price ($)</label>
              <input type="number" id="ps-entry" placeholder="150.00">
            </div>
            <div class="form-group">
              <label>Stop Loss ($)</label>
              <input type="number" id="ps-stop" placeholder="145.00">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcPositionSize()">Calculate Position Size</button>
        <div class="results" id="ps-results">
          <div class="result-row">
            <span class="result-label">Position Size</span>
            <span class="result-value highlight" id="ps-size">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Dollar Risk</span>
            <span class="result-value" id="ps-dollar-risk">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Risk Per Share</span>
            <span class="result-value" id="ps-risk-share">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Total Position Value</span>
            <span class="result-value" id="ps-value">‚Äî</span>
          </div>
          <button class="share-result" id="ps-share" onclick="shareCalc('ps')">üìã Copy shareable link</button>
        </div>
        <a href="https://education.signalpilot.io/curriculum/beginner/09-position-sizing.html" target="_blank" rel="noopener" class="learn-link">Learn the 1% rule ‚Üí</a>
      </div>

      <!-- Risk/Reward Calculator -->
      <div class="tool-card">
        <h3>‚öñÔ∏è Risk/Reward Calculator</h3>
        <p class="description">Evaluate trade quality by calculating your R:R ratio and required win rate to be profitable.</p>
        <div class="form-area">
          <div class="form-group">
            <label>Entry Price ($)</label>
            <input type="number" id="rr-entry" placeholder="100.00">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Stop Loss ($)</label>
              <input type="number" id="rr-stop" placeholder="95.00">
            </div>
            <div class="form-group">
              <label>Take Profit ($)</label>
              <input type="number" id="rr-target" placeholder="115.00">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcRiskReward()">Calculate R:R</button>
        <div class="results" id="rr-results">
          <div class="result-row">
            <span class="result-label">Risk/Reward Ratio</span>
            <span class="result-value highlight" id="rr-ratio">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Risk Per Share</span>
            <span class="result-value" id="rr-risk">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Reward Per Share</span>
            <span class="result-value" id="rr-reward">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Min Win Rate Needed</span>
            <span class="result-value" id="rr-winrate">‚Äî</span>
          </div>
          <div id="rr-verdict"></div>
          <button class="share-result" id="rr-share" onclick="shareCalc('rr')">üìã Copy shareable link</button>
        </div>
        <a href="https://blog.signalpilot.io/articles/the-1-percent-rule/" target="_blank" rel="noopener" class="learn-link">Why R:R matters ‚Üí</a>
      </div>

      <!-- Profit/Loss Calculator -->
      <div class="tool-card">
        <h3>üí∞ Profit/Loss Calculator</h3>
        <p class="description">Calculate your P&L for any trade, whether you're going long or shorting.</p>
        <div class="form-area">
          <div class="form-group">
            <label>Position Type</label>
            <select id="pl-type">
              <option value="long">Long (Buy)</option>
              <option value="short">Short (Sell)</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Entry Price ($)</label>
              <input type="number" id="pl-entry" placeholder="100.00">
            </div>
            <div class="form-group">
              <label>Exit Price ($)</label>
              <input type="number" id="pl-exit" placeholder="110.00">
            </div>
          </div>
          <div class="form-group">
            <label>Number of Shares</label>
            <input type="number" id="pl-shares" placeholder="100">
          </div>
        </div>
        <button class="calc-btn" onclick="calcProfitLoss()">Calculate P&L</button>
        <div class="results" id="pl-results">
          <div class="result-row">
            <span class="result-label">Profit/Loss</span>
            <span class="result-value highlight" id="pl-amount">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Return %</span>
            <span class="result-value" id="pl-percent">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Entry Value</span>
            <span class="result-value" id="pl-entry-val">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Exit Value</span>
            <span class="result-value" id="pl-exit-val">‚Äî</span>
          </div>
        </div>
        <a href="https://education.signalpilot.io/curriculum/intermediate/34-trade-journal-mastery.html" target="_blank" rel="noopener" class="learn-link">Master trade journaling ‚Üí</a>
      </div>
    </div>

    <!-- RISK ANALYSIS -->
    <div class="section-header">
      <h2>Risk Analysis <span>‚Äî Know your edge</span></h2>
    </div>

    <div class="tools-grid">
      <!-- Drawdown Recovery -->
      <div class="tool-card">
        <h3>üìâ Drawdown Recovery Calculator</h3>
        <p class="description">The math of losses is brutal. See exactly how much you need to recover from a drawdown.</p>
        <div class="form-area">
          <div class="form-group">
            <label>Drawdown / Loss (%)</label>
            <input type="number" id="dd-loss" placeholder="25">
            <p class="hint">How much your account has dropped from peak</p>
          </div>
        </div>
        <button class="calc-btn" onclick="calcDrawdown()">Calculate Recovery</button>
        <div class="results" id="dd-results">
          <div class="result-row">
            <span class="result-label">Recovery Needed</span>
            <span class="result-value highlight" id="dd-recovery">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">$10,000 becomes</span>
            <span class="result-value" id="dd-after">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Need to reach</span>
            <span class="result-value" id="dd-target">$10,000</span>
          </div>
          <div class="insight" id="dd-insight"></div>
        </div>
        <a href="https://blog.signalpilot.io/articles/accumulation-vs-distribution/" target="_blank" rel="noopener" class="learn-link">Avoid drawdowns ‚Üí</a>
      </div>

      <!-- Kelly Criterion -->
      <div class="tool-card">
        <h3>üéØ Kelly Criterion Calculator</h3>
        <p class="description">The mathematically optimal bet size based on your edge. Used by professional gamblers and traders.</p>
        <div class="form-area">
          <div class="form-row">
            <div class="form-group">
              <label>Win Rate (%)</label>
              <input type="number" id="kelly-winrate" placeholder="55">
              <p class="hint">Your historical win %</p>
            </div>
            <div class="form-group">
              <label>Win/Loss Ratio</label>
              <input type="number" id="kelly-ratio" placeholder="1.5">
              <p class="hint">Avg win √∑ Avg loss</p>
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcKelly()">Calculate Kelly %</button>
        <div class="results" id="kelly-results">
          <div class="result-row">
            <span class="result-label">Full Kelly</span>
            <span class="result-value highlight" id="kelly-full">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Half Kelly</span>
            <span class="result-value good" id="kelly-half">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Quarter Kelly</span>
            <span class="result-value" id="kelly-quarter">‚Äî</span>
          </div>
          <div class="insight" id="kelly-insight"></div>
        </div>
        <a href="https://education.signalpilot.io/curriculum/intermediate/33-advanced-risk-management.html" target="_blank" rel="noopener" class="learn-link">Advanced position sizing ‚Üí</a>
      </div>

      <!-- Expectancy -->
      <div class="tool-card">
        <h3>üßÆ Expectancy Calculator</h3>
        <p class="description">Your expected profit per trade. Positive = edge. This is the most important metric for any system.</p>
        <div class="form-area">
          <div class="form-row">
            <div class="form-group">
              <label>Win Rate (%)</label>
              <input type="number" id="exp-winrate" placeholder="55" oninput="updateLossRate()">
            </div>
            <div class="form-group">
              <label>Average Win ($)</label>
              <input type="number" id="exp-avgwin" placeholder="150">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Loss Rate (%)</label>
              <input type="number" id="exp-lossrate" placeholder="45" readonly style="opacity:0.6">
            </div>
            <div class="form-group">
              <label>Average Loss ($)</label>
              <input type="number" id="exp-avgloss" placeholder="100">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcExpectancy()">Calculate Expectancy</button>
        <div class="results" id="exp-results">
          <div class="result-row">
            <span class="result-label">Expectancy / Trade</span>
            <span class="result-value highlight" id="exp-value">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Per 100 Trades</span>
            <span class="result-value" id="exp-100">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Profit Factor</span>
            <span class="result-value" id="exp-pf">‚Äî</span>
          </div>
          <div class="insight" id="exp-insight"></div>
        </div>
        <a href="https://blog.signalpilot.io/articles/building-your-first-system/" target="_blank" rel="noopener" class="learn-link">Build a trading system ‚Üí</a>
      </div>

      <!-- Portfolio Heat -->
      <div class="tool-card">
        <h3>üî• Portfolio Heat Calculator</h3>
        <p class="description">Total risk exposure across all open positions. Keep this under control to survive drawdowns.</p>
        <div class="form-area">
          <div class="form-group">
            <label>Account Balance ($)</label>
            <input type="number" id="heat-balance" placeholder="50000">
          </div>
          <div class="form-group">
            <label>Total $ at Risk (all positions)</label>
            <input type="number" id="heat-risk" placeholder="3000">
            <p class="hint">Sum of (position size √ó distance to stop) for all trades</p>
          </div>
        </div>
        <button class="calc-btn" onclick="calcHeat()">Calculate Heat</button>
        <div class="results" id="heat-results">
          <div class="result-row">
            <span class="result-label">Portfolio Heat</span>
            <span class="result-value highlight" id="heat-pct">‚Äî</span>
          </div>
          <div id="heat-verdict"></div>
          <div class="insight" id="heat-insight"></div>
        </div>
        <a href="https://education.signalpilot.io/curriculum/intermediate/46-advanced-risk-management.html" target="_blank" rel="noopener" class="learn-link">Risk management mastery ‚Üí</a>
      </div>
    </div>

    <!-- GROWTH & PLANNING -->
    <div class="section-header">
      <h2>Growth & Planning <span>‚Äî Think long term</span></h2>
    </div>

    <div class="tools-grid">
      <!-- Compound Growth -->
      <div class="tool-card">
        <h3>üìà Compound Growth Calculator</h3>
        <p class="description">See how consistent returns compound over time. Small edges become massive with patience.</p>
        <div class="form-area">
          <div class="form-row">
            <div class="form-group">
              <label>Starting Balance ($)</label>
              <input type="number" id="cg-start" placeholder="10000">
            </div>
            <div class="form-group">
              <label>Monthly Return (%)</label>
              <input type="number" id="cg-return" placeholder="5">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Months</label>
              <input type="number" id="cg-months" placeholder="12">
            </div>
            <div class="form-group">
              <label>Monthly Addition ($)</label>
              <input type="number" id="cg-add" placeholder="500">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcCompound()">Calculate Growth</button>
        <div class="results" id="cg-results">
          <div class="result-row">
            <span class="result-label">Final Balance</span>
            <span class="result-value highlight" id="cg-final">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Total Gain</span>
            <span class="result-value good" id="cg-gain">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Total Added</span>
            <span class="result-value" id="cg-added">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Total Return</span>
            <span class="result-value" id="cg-return-pct">‚Äî</span>
          </div>
        </div>
        <a href="https://education.signalpilot.io/curriculum/advanced/74-building-trading-business.html" target="_blank" rel="noopener" class="learn-link">Long-term wealth building ‚Üí</a>
      </div>

      <!-- Break-Even -->
      <div class="tool-card">
        <h3>‚ö° Break-Even Calculator</h3>
        <p class="description">How much does price need to move just to cover your costs? Don't let fees eat your edge.</p>
        <div class="form-area">
          <div class="form-row">
            <div class="form-group">
              <label>Entry Price ($)</label>
              <input type="number" id="be-entry" placeholder="100.00">
            </div>
            <div class="form-group">
              <label>Shares</label>
              <input type="number" id="be-shares" placeholder="100">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Commission per Trade ($)</label>
              <input type="number" id="be-commission" placeholder="0">
            </div>
            <div class="form-group">
              <label>Spread / Slippage ($)</label>
              <input type="number" id="be-spread" placeholder="0.05">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcBreakEven()">Calculate Break-Even</button>
        <div class="results" id="be-results">
          <div class="result-row">
            <span class="result-label">Break-Even Price</span>
            <span class="result-value highlight" id="be-price">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Move Required</span>
            <span class="result-value" id="be-move">‚Äî</span>
          </div>
          <div class="result-row">
            <span class="result-label">Total Costs</span>
            <span class="result-value bad" id="be-costs">‚Äî</span>
          </div>
        </div>
        <a href="https://blog.signalpilot.io/articles/free-indicators-vs-professional-tools/" target="_blank" rel="noopener" class="learn-link">Choose the right tools ‚Üí</a>
      </div>

      <!-- R-Multiple -->
      <div class="tool-card">
        <h3>üìä R-Multiple Calculator</h3>
        <p class="description">Express all trades in terms of R (initial risk). The language of professional traders.</p>
        <div class="form-area">
          <div class="form-row">
            <div class="form-group">
              <label>Initial Risk ($)</label>
              <input type="number" id="rm-risk" placeholder="100">
              <p class="hint">Your 1R amount</p>
            </div>
            <div class="form-group">
              <label>Actual P&L ($)</label>
              <input type="number" id="rm-pnl" placeholder="250">
            </div>
          </div>
        </div>
        <button class="calc-btn" onclick="calcRMultiple()">Calculate R-Multiple</button>
        <div class="results" id="rm-results">
          <div class="result-row">
            <span class="result-label">R-Multiple</span>
            <span class="result-value highlight" id="rm-value">‚Äî</span>
          </div>
          <div id="rm-verdict"></div>
          <div class="insight">A +2R win means you made twice what you risked. Track all trades in R to normalize performance across different position sizes.</div>
        </div>
        <a href="https://blog.signalpilot.io/articles/your-first-trade/" target="_blank" rel="noopener" class="learn-link">Track your first trade ‚Üí</a>
      </div>
    </div>

    <!-- FROM THE BLOG -->
    <div class="blog-section">
      <h2>üìö From the Blog</h2>
      <div class="blog-grid">
        <a href="https://blog.signalpilot.io/articles/the-1-percent-rule/" target="_blank" rel="noopener" class="blog-card">
          <span class="blog-icon">üí∞</span>
          <div>
            <h3>The 1% Rule</h3>
            <p>Why risking 1% per trade changed everything</p>
          </div>
        </a>
        <a href="https://blog.signalpilot.io/articles/building-your-first-system/" target="_blank" rel="noopener" class="blog-card">
          <span class="blog-icon">üîß</span>
          <div>
            <h3>Building Your First System</h3>
            <p>From random trades to consistent profits</p>
          </div>
        </a>
        <a href="https://blog.signalpilot.io/articles/how-smart-money-moves/" target="_blank" rel="noopener" class="blog-card">
          <span class="blog-icon">üèõÔ∏è</span>
          <div>
            <h3>How Smart Money Moves</h3>
            <p>Follow institutional footprints in the market</p>
          </div>
        </a>
        <a href="https://blog.signalpilot.io/articles/why-your-indicators-keep-failing/" target="_blank" rel="noopener" class="blog-card">
          <span class="blog-icon">üìâ</span>
          <div>
            <h3>Why Your Indicators Keep Failing</h3>
            <p>The repainting problem explained</p>
          </div>
        </a>
      </div>
    </div>

    <!-- QUIZ PROMO -->
    <div class="quiz-promo">
      <h3>What's Your Trading Style?</h3>
      <p>Take our 2-minute quiz to discover if you're a scalper, day trader, swing trader, or position trader</p>
      <a href="/tools/quiz/">Take the Quiz ‚Üí</a>
    </div>

    <!-- EMBED CODE -->
    <div class="embed-section">
      <h3>üîó Embed on Your Site</h3>
      <p>Share these calculators with your community. Free backlinks welcome!</p>
      <div class="embed-code" id="embed-code">&lt;iframe src="https://signalpilot.io/tools/" width="100%" height="800" frameborder="0" style="border-radius:16px"&gt;&lt;/iframe&gt;</div>
      <button class="embed-btn" onclick="copyEmbed()">Copy Embed Code</button>
    </div>

    <footer class="footer">
      <a href="https://education.signalpilot.io/calculators.html" target="_blank" class="see-all">See all 14 calculators on Education Hub ‚Üí</a>
      <p>Built by <a href="https://signalpilot.io">Signal Pilot</a> ‚Äî Professional trading indicators for TradingView</p>
    </footer>
  </div>

  <div class="toast" id="toast">Link copied!</div>

  <!-- Email Modal -->
  <div class="modal-overlay" id="email-modal">
    <div class="modal">
      <h3>Get Trading Tips</h3>
      <p>Enter your email for weekly trading insights and risk management tips.</p>
      <input type="email" id="email-input" placeholder="your@email.com">
      <label class="checkbox-row">
        <input type="checkbox" id="subscribe-check" checked>
        Send me weekly trading insights
      </label>
      <div class="modal-actions">
        <button class="modal-btn cancel" onclick="hideEmailModal()">Cancel</button>
        <button class="modal-btn submit" onclick="submitEmail()">Subscribe</button>
      </div>
    </div>
  </div>

  <!-- Share Card Modal -->
  <div class="modal-overlay" id="share-modal">
    <div class="modal">
      <h3>Share Your Result</h3>
      <div class="share-card-preview" id="share-card-preview">
        <div class="card-result" id="card-result">1:3.2</div>
        <div class="card-label" id="card-label">Risk/Reward Ratio</div>
        <span class="card-verdict good" id="card-verdict">Excellent Setup</span>
        <div class="card-brand">signalpilot.io/tools</div>
      </div>
      <div class="share-buttons-row">
        <button onclick="shareToTwitter()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          Twitter
        </button>
        <button onclick="shareToReddit()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249z"/></svg>
          Reddit
        </button>
        <button onclick="copyShareLink()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
          Copy
        </button>
      </div>
      <button class="modal-btn cancel" style="width:100%;margin-top:1rem" onclick="hideShareModal()">Close</button>
    </div>
  </div>

  <script>
    // Theme
    function toggleTheme() {
      const html = document.documentElement;
      const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      document.getElementById('theme-icon').textContent = next === 'light' ? '‚òÄÔ∏è' : 'üåô';
      document.getElementById('theme-text').textContent = next === 'light' ? 'Light' : 'Dark';
    }

    (function() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
        document.getElementById('theme-text').textContent = 'Light';
      }
    })();

    // Helpers
    function fmt(n, decimals = 2) {
      return n.toLocaleString(undefined, {minimumFractionDigits: decimals, maximumFractionDigits: decimals});
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    function copyLink() {
      navigator.clipboard.writeText('https://signalpilot.io/tools/');
      showToast('Link copied!');
    }

    function copyEmbed() {
      // Include affiliate ref if present
      const ref = getAffiliateRef();
      const url = ref ? `https://signalpilot.io/tools/?ref=${ref}` : 'https://signalpilot.io/tools/';
      const code = `<iframe src="${url}" width="100%" height="800" frameborder="0" style="border-radius:16px"></iframe>`;
      navigator.clipboard.writeText(code);
      showToast('Embed code copied!');
    }

    // Affiliate tracking
    function getAffiliateRef() {
      const params = new URLSearchParams(window.location.search);
      return params.get('ref');
    }

    function trackAffiliate() {
      const ref = getAffiliateRef();
      if (ref) {
        // Store in cookie for 30 days
        document.cookie = `sp_ref=${ref};max-age=${30*24*60*60};path=/`;
        console.log('Affiliate tracked:', ref);
      }
    }

    // Run on page load
    trackAffiliate();

    // Current share data
    let currentShareData = { result: '', label: '', verdict: '', verdictClass: 'good' };

    // Last calculation data for PDF
    let lastCalculation = null;

    function shareCalc(prefix) {
      // Get calculator-specific data
      if (prefix === 'rr') {
        const ratio = document.getElementById('rr-ratio').textContent;
        const verdictEl = document.getElementById('rr-verdict').querySelector('.verdict');
        currentShareData = {
          result: ratio,
          label: 'Risk/Reward Ratio',
          verdict: verdictEl ? verdictEl.textContent : 'Calculated',
          verdictClass: verdictEl ? (verdictEl.classList.contains('good') ? 'good' : verdictEl.classList.contains('bad') ? 'bad' : 'warn') : 'good'
        };
      } else if (prefix === 'ps') {
        const size = document.getElementById('ps-size').textContent;
        currentShareData = {
          result: size,
          label: 'Position Size',
          verdict: 'Calculated',
          verdictClass: 'good'
        };
      }
      showShareModal();
    }

    // Email Modal
    function showEmailModal() {
      document.getElementById('email-modal').classList.add('show');
    }

    function hideEmailModal() {
      document.getElementById('email-modal').classList.remove('show');
    }

    function submitEmail() {
      const email = document.getElementById('email-input').value;
      if (!email || !email.includes('@')) {
        showToast('Please enter a valid email');
        return;
      }
      const subscribe = document.getElementById('subscribe-check').checked;

      // Build payload with calculator data if available
      const payload = {
        email: email,
        subscribe: subscribe ? 'Yes' : 'No',
        source: lastCalculation ? lastCalculation.calculator : 'tools-page',
        calculator: lastCalculation ? lastCalculation.calculator : '',
        inputs: lastCalculation ? lastCalculation.inputs : '',
        result: lastCalculation ? lastCalculation.result : ''
      };

      // Send to Make.com webhook
      fetch('https://hook.eu1.make.com/gkq7a53rcd51ok5ufsb9lgo3fo05f4i4', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).catch(err => console.log('Webhook error:', err));

      hideEmailModal();
      showToast('Thanks! Check your inbox.');
    }

    // Close modal on overlay click
    document.getElementById('email-modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('email-modal')) hideEmailModal();
    });

    // Share Modal
    function showShareModal() {
      document.getElementById('card-result').textContent = currentShareData.result;
      document.getElementById('card-label').textContent = currentShareData.label;
      const verdictEl = document.getElementById('card-verdict');
      verdictEl.textContent = currentShareData.verdict;
      verdictEl.className = 'card-verdict ' + currentShareData.verdictClass;
      document.getElementById('share-modal').classList.add('show');
    }

    function hideShareModal() {
      document.getElementById('share-modal').classList.remove('show');
    }

    function shareToTwitter() {
      const text = `My ${currentShareData.label}: ${currentShareData.result} - ${currentShareData.verdict}`;
      const url = 'https://signalpilot.io/tools/';
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    }

    function shareToReddit() {
      const title = `My ${currentShareData.label}: ${currentShareData.result}`;
      const url = 'https://signalpilot.io/tools/';
      window.open(`https://reddit.com/submit?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`, '_blank');
    }

    function copyShareLink() {
      navigator.clipboard.writeText('https://signalpilot.io/tools/');
      showToast('Link copied!');
      hideShareModal();
    }

    document.getElementById('share-modal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('share-modal')) hideShareModal();
    });

    function updateLossRate() {
      const wr = parseFloat(document.getElementById('exp-winrate').value);
      if (wr >= 0 && wr <= 100) {
        document.getElementById('exp-lossrate').value = (100 - wr).toFixed(1);
      }
    }

    // Position Size
    function calcPositionSize() {
      const balance = parseFloat(document.getElementById('ps-balance').value);
      const riskPct = parseFloat(document.getElementById('ps-risk').value);
      const entry = parseFloat(document.getElementById('ps-entry').value);
      const stop = parseFloat(document.getElementById('ps-stop').value);
      if (!balance || !riskPct || !entry || !stop) return;

      const dollarRisk = balance * (riskPct / 100);
      const riskPerShare = Math.abs(entry - stop);
      const size = Math.floor(dollarRisk / riskPerShare);
      const value = size * entry;

      document.getElementById('ps-size').textContent = size.toLocaleString() + ' shares';
      document.getElementById('ps-dollar-risk').textContent = '$' + fmt(dollarRisk);
      document.getElementById('ps-risk-share').textContent = '$' + fmt(riskPerShare);
      document.getElementById('ps-value').textContent = '$' + fmt(value);
      document.getElementById('ps-results').classList.add('show');
      document.getElementById('ps-share').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Position Size',
        inputs: `Balance: $${fmt(balance)}, Risk: ${riskPct}%, Entry: $${fmt(entry)}, Stop: $${fmt(stop)}`,
        result: `${size.toLocaleString()} shares ($${fmt(value)} position, $${fmt(dollarRisk)} at risk)`
      };
    }

    // Risk/Reward
    function calcRiskReward() {
      const entry = parseFloat(document.getElementById('rr-entry').value);
      const stop = parseFloat(document.getElementById('rr-stop').value);
      const target = parseFloat(document.getElementById('rr-target').value);
      if (!entry || !stop || !target) return;

      const risk = Math.abs(entry - stop);
      const reward = Math.abs(target - entry);
      const ratio = reward / risk;
      const minWR = (1 / (1 + ratio)) * 100;

      const ratioEl = document.getElementById('rr-ratio');
      ratioEl.textContent = '1:' + ratio.toFixed(2);
      ratioEl.className = 'result-value highlight ' + (ratio >= 2 ? 'good' : ratio >= 1 ? '' : 'bad');

      document.getElementById('rr-risk').textContent = '$' + fmt(risk);
      document.getElementById('rr-reward').textContent = '$' + fmt(reward);

      const wrEl = document.getElementById('rr-winrate');
      wrEl.textContent = minWR.toFixed(1) + '%';
      wrEl.className = 'result-value ' + (minWR <= 40 ? 'good' : minWR <= 50 ? '' : 'warn');

      const verdictEl = document.getElementById('rr-verdict');
      if (ratio >= 2) {
        verdictEl.innerHTML = '<span class="verdict good">Excellent Setup</span>';
      } else if (ratio >= 1) {
        verdictEl.innerHTML = '<span class="verdict warn">Acceptable</span>';
      } else {
        verdictEl.innerHTML = '<span class="verdict bad">Poor R:R</span>';
      }

      document.getElementById('rr-results').classList.add('show');
      document.getElementById('rr-share').classList.add('show');

      // Store for PDF
      const verdict = ratio >= 2 ? 'Excellent' : ratio >= 1 ? 'Acceptable' : 'Poor';
      lastCalculation = {
        calculator: 'Risk/Reward',
        inputs: `Entry: $${fmt(entry)}, Stop: $${fmt(stop)}, Target: $${fmt(target)}`,
        result: `1:${ratio.toFixed(2)} ratio (${verdict}) - Need ${minWR.toFixed(1)}% win rate`
      };
    }

    // Profit/Loss
    function calcProfitLoss() {
      const type = document.getElementById('pl-type').value;
      const entry = parseFloat(document.getElementById('pl-entry').value);
      const exit = parseFloat(document.getElementById('pl-exit').value);
      const shares = parseFloat(document.getElementById('pl-shares').value);
      if (!entry || !exit || !shares) return;

      const entryVal = entry * shares;
      const exitVal = exit * shares;
      let pl = type === 'long' ? exitVal - entryVal : entryVal - exitVal;
      let pct = type === 'long' ? ((exit - entry) / entry) * 100 : ((entry - exit) / entry) * 100;

      const plEl = document.getElementById('pl-amount');
      plEl.textContent = (pl >= 0 ? '+$' : '-$') + fmt(Math.abs(pl));
      plEl.className = 'result-value highlight ' + (pl >= 0 ? 'good' : 'bad');

      const pctEl = document.getElementById('pl-percent');
      pctEl.textContent = (pct >= 0 ? '+' : '') + pct.toFixed(2) + '%';
      pctEl.className = 'result-value ' + (pct >= 0 ? 'good' : 'bad');

      document.getElementById('pl-entry-val').textContent = '$' + fmt(entryVal);
      document.getElementById('pl-exit-val').textContent = '$' + fmt(exitVal);
      document.getElementById('pl-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Profit/Loss',
        inputs: `${type.toUpperCase()}: Entry $${fmt(entry)}, Exit $${fmt(exit)}, ${shares} shares`,
        result: `${pl >= 0 ? '+' : ''}$${fmt(pl)} (${pct >= 0 ? '+' : ''}${pct.toFixed(2)}%)`
      };
    }

    // Drawdown
    function calcDrawdown() {
      const loss = parseFloat(document.getElementById('dd-loss').value);
      if (!loss || loss <= 0 || loss >= 100) return;

      const recovery = (loss / (100 - loss)) * 100;
      const after = 10000 * (1 - loss / 100);

      const recEl = document.getElementById('dd-recovery');
      recEl.textContent = '+' + recovery.toFixed(1) + '%';
      recEl.className = 'result-value highlight ' + (recovery > 100 ? 'bad' : recovery > 50 ? 'warn' : 'good');

      document.getElementById('dd-after').textContent = '$' + fmt(after);

      let insight = '';
      if (loss <= 10) insight = '<strong>Minor setback.</strong> Stay disciplined and you\'ll recover quickly.';
      else if (loss <= 25) insight = '<strong>Moderate drawdown.</strong> Consider reducing position sizes until you recover.';
      else if (loss <= 50) insight = '<strong>Serious damage.</strong> You need ' + recovery.toFixed(0) + '% just to break even. Re-evaluate your strategy.';
      else insight = '<strong>Critical.</strong> Losses this large are extremely hard to recover from. Capital preservation is everything.';

      document.getElementById('dd-insight').innerHTML = insight;
      document.getElementById('dd-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Drawdown Recovery',
        inputs: `Drawdown: ${loss}%`,
        result: `Need +${recovery.toFixed(1)}% to recover ($10k ‚Üí $${fmt(after)})`
      };
    }

    // Kelly
    function calcKelly() {
      const wr = parseFloat(document.getElementById('kelly-winrate').value) / 100;
      const ratio = parseFloat(document.getElementById('kelly-ratio').value);
      if (!wr || !ratio || wr <= 0 || wr >= 1) return;

      const kelly = (wr - ((1 - wr) / ratio)) * 100;
      const half = kelly / 2;
      const quarter = kelly / 4;

      const fullEl = document.getElementById('kelly-full');
      fullEl.textContent = kelly.toFixed(1) + '%';
      fullEl.className = 'result-value highlight ' + (kelly <= 0 ? 'bad' : kelly > 25 ? 'warn' : 'good');

      document.getElementById('kelly-half').textContent = Math.max(0, half).toFixed(1) + '%';
      document.getElementById('kelly-quarter').textContent = Math.max(0, quarter).toFixed(1) + '%';

      let insight = '';
      if (kelly <= 0) insight = '<strong>No edge.</strong> Kelly says don\'t bet. Your win rate or reward ratio is too low.';
      else if (kelly > 25) insight = '<strong>High Kelly.</strong> Full Kelly is aggressive. Most pros use Half Kelly (' + half.toFixed(1) + '%) for smoother equity curves.';
      else insight = '<strong>Positive edge.</strong> Half Kelly (' + half.toFixed(1) + '%) recommended for optimal growth with manageable volatility.';

      document.getElementById('kelly-insight').innerHTML = insight;
      document.getElementById('kelly-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Kelly Criterion',
        inputs: `Win Rate: ${(wr*100).toFixed(0)}%, Win/Loss Ratio: ${ratio}`,
        result: `Full Kelly: ${kelly.toFixed(1)}%, Half Kelly: ${half.toFixed(1)}% (recommended)`
      };
    }

    // Expectancy
    function calcExpectancy() {
      const wr = parseFloat(document.getElementById('exp-winrate').value) / 100;
      const avgWin = parseFloat(document.getElementById('exp-avgwin').value);
      const avgLoss = parseFloat(document.getElementById('exp-avgloss').value);
      if (!wr || !avgWin || !avgLoss) return;

      const lr = 1 - wr;
      const exp = (wr * avgWin) - (lr * avgLoss);
      const per100 = exp * 100;
      const pf = (wr * avgWin) / (lr * avgLoss);

      const expEl = document.getElementById('exp-value');
      expEl.textContent = (exp >= 0 ? '+$' : '-$') + fmt(Math.abs(exp));
      expEl.className = 'result-value highlight ' + (exp >= 0 ? 'good' : 'bad');

      const per100El = document.getElementById('exp-100');
      per100El.textContent = (per100 >= 0 ? '+$' : '-$') + fmt(Math.abs(per100));
      per100El.className = 'result-value ' + (per100 >= 0 ? 'good' : 'bad');

      const pfEl = document.getElementById('exp-pf');
      pfEl.textContent = pf.toFixed(2);
      pfEl.className = 'result-value ' + (pf >= 1.5 ? 'good' : pf >= 1 ? '' : 'bad');

      let insight = '';
      if (exp < 0) insight = '<strong>Negative expectancy.</strong> This strategy loses money. Improve win rate or R:R.';
      else if (pf < 1.2) insight = '<strong>Marginal edge.</strong> Barely profitable. Fees may eat your returns.';
      else if (pf >= 2) insight = '<strong>Strong edge.</strong> Profit factor of ' + pf.toFixed(2) + ' indicates a robust system.';
      else insight = '<strong>Positive edge.</strong> You make $' + fmt(exp) + ' per trade on average. Consistency is key.';

      document.getElementById('exp-insight').innerHTML = insight;
      document.getElementById('exp-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Expectancy',
        inputs: `Win Rate: ${(wr*100).toFixed(0)}%, Avg Win: $${fmt(avgWin)}, Avg Loss: $${fmt(avgLoss)}`,
        result: `$${fmt(exp)}/trade, Profit Factor: ${pf.toFixed(2)}`
      };
    }

    // Portfolio Heat
    function calcHeat() {
      const balance = parseFloat(document.getElementById('heat-balance').value);
      const risk = parseFloat(document.getElementById('heat-risk').value);
      if (!balance || !risk) return;

      const heat = (risk / balance) * 100;

      const heatEl = document.getElementById('heat-pct');
      heatEl.textContent = heat.toFixed(1) + '%';
      heatEl.className = 'result-value highlight ' + (heat > 10 ? 'bad' : heat > 6 ? 'warn' : 'good');

      const verdictEl = document.getElementById('heat-verdict');
      if (heat <= 6) verdictEl.innerHTML = '<span class="verdict good">Safe</span>';
      else if (heat <= 10) verdictEl.innerHTML = '<span class="verdict warn">Elevated</span>';
      else verdictEl.innerHTML = '<span class="verdict bad">Dangerous</span>';

      let insight = '';
      if (heat <= 6) insight = '<strong>Conservative exposure.</strong> You can weather significant drawdowns.';
      else if (heat <= 10) insight = '<strong>Moderate exposure.</strong> Be cautious adding new positions.';
      else insight = '<strong>High risk.</strong> A correlated move against you could cause serious damage. Consider reducing exposure.';

      document.getElementById('heat-insight').innerHTML = insight;
      document.getElementById('heat-results').classList.add('show');

      // Store for PDF
      const heatVerdict = heat <= 6 ? 'Safe' : heat <= 10 ? 'Elevated' : 'Dangerous';
      lastCalculation = {
        calculator: 'Portfolio Heat',
        inputs: `Balance: $${fmt(balance)}, Total Risk: $${fmt(risk)}`,
        result: `${heat.toFixed(1)}% heat (${heatVerdict})`
      };
    }

    // Compound Growth
    function calcCompound() {
      const start = parseFloat(document.getElementById('cg-start').value);
      const ret = parseFloat(document.getElementById('cg-return').value) / 100;
      const months = parseInt(document.getElementById('cg-months').value);
      const add = parseFloat(document.getElementById('cg-add').value) || 0;
      if (!start || !ret || !months) return;

      let bal = start;
      for (let i = 0; i < months; i++) bal = bal * (1 + ret) + add;

      const totalAdded = add * months;
      const gain = bal - start - totalAdded;
      const retPct = ((bal - start) / start) * 100;

      document.getElementById('cg-final').textContent = '$' + fmt(bal);
      document.getElementById('cg-gain').textContent = '+$' + fmt(gain);
      document.getElementById('cg-added').textContent = '$' + fmt(totalAdded);
      document.getElementById('cg-return-pct').textContent = '+' + retPct.toFixed(1) + '%';
      document.getElementById('cg-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Compound Growth',
        inputs: `Start: $${fmt(start)}, ${(ret*100).toFixed(0)}%/month, ${months} months, +$${fmt(add)}/mo`,
        result: `$${fmt(bal)} final (+${retPct.toFixed(1)}% total)`
      };
    }

    // Break-Even
    function calcBreakEven() {
      const entry = parseFloat(document.getElementById('be-entry').value);
      const shares = parseFloat(document.getElementById('be-shares').value);
      const comm = parseFloat(document.getElementById('be-commission').value) || 0;
      const spread = parseFloat(document.getElementById('be-spread').value) || 0;
      if (!entry || !shares) return;

      const totalCosts = (comm * 2) + (spread * shares * 2);
      const moveNeeded = totalCosts / shares;
      const bePrice = entry + moveNeeded;

      document.getElementById('be-price').textContent = '$' + fmt(bePrice, 4);
      document.getElementById('be-move').textContent = '+$' + fmt(moveNeeded, 4) + ' (' + ((moveNeeded / entry) * 100).toFixed(3) + '%)';
      document.getElementById('be-costs').textContent = '-$' + fmt(totalCosts);
      document.getElementById('be-results').classList.add('show');

      // Store for PDF
      lastCalculation = {
        calculator: 'Break-Even',
        inputs: `Entry: $${fmt(entry)}, ${shares} shares, Comm: $${fmt(comm)}, Spread: $${fmt(spread)}`,
        result: `Break-even at $${fmt(bePrice, 4)} (costs: $${fmt(totalCosts)})`
      };
    }

    // R-Multiple
    function calcRMultiple() {
      const risk = parseFloat(document.getElementById('rm-risk').value);
      const pnl = parseFloat(document.getElementById('rm-pnl').value);
      if (!risk) return;

      const r = pnl / risk;

      const rEl = document.getElementById('rm-value');
      rEl.textContent = (r >= 0 ? '+' : '') + r.toFixed(2) + 'R';
      rEl.className = 'result-value highlight ' + (r >= 2 ? 'good' : r >= 0 ? '' : 'bad');

      const verdictEl = document.getElementById('rm-verdict');
      if (r >= 3) verdictEl.innerHTML = '<span class="verdict good">Home Run</span>';
      else if (r >= 2) verdictEl.innerHTML = '<span class="verdict good">Solid Win</span>';
      else if (r >= 0) verdictEl.innerHTML = '<span class="verdict warn">Small Win</span>';
      else if (r >= -1) verdictEl.innerHTML = '<span class="verdict warn">Controlled Loss</span>';
      else verdictEl.innerHTML = '<span class="verdict bad">Exceeded Risk</span>';

      document.getElementById('rm-results').classList.add('show');

      // Store for PDF
      const rmVerdict = r >= 3 ? 'Home Run' : r >= 2 ? 'Solid Win' : r >= 0 ? 'Small Win' : r >= -1 ? 'Controlled Loss' : 'Exceeded Risk';
      lastCalculation = {
        calculator: 'R-Multiple',
        inputs: `Initial Risk: $${fmt(risk)}, P&L: $${fmt(pnl)}`,
        result: `${r >= 0 ? '+' : ''}${r.toFixed(2)}R (${rmVerdict})`
      };
    }

    // Enter key triggers calc
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          const btn = e.target.closest('.tool-card').querySelector('.calc-btn');
          if (btn) btn.click();
        }
      });
    });
  </script>
</body>
</html>
